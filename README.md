# ๐งญ AIโะฟะพะผะพัะฝะธะบ ัััะธััะฐ โ ัะตััะพะฒะพะต ะทะฐะดะฐะฝะธะต GORKYCODE 2025

ะัะพัะพัะธะฟ ัะตัะฒะธัะฐ, ะบะพัะพััะน ัะพัะผะธััะตั **ะฟะตััะพะฝะฐะปัะฝัะน ะผะฐััััั ะฟัะพะณัะปะบะธ ะฟะพ ะะธะถะฝะตะผั ะะพะฒะณะพัะพะดั** ะฝะฐ ะพัะฝะพะฒะต ะธะฝัะตัะตัะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปั, ะตะณะพ ะดะพัััะฟะฝะพะณะพ ะฒัะตะผะตะฝะธ ะธ ะผะตััะพะฟะพะปะพะถะตะฝะธั.  
ะะฐะทัะฐะฑะพัะฐะฝ ะฒ ัะฐะผะบะฐั ัะตััะพะฒะพะณะพ ะทะฐะดะฐะฝะธั ัะฐะบะฐัะพะฝะฐ **GORKYCODE 2025**.

---

## ๐ ะัะฝะพะฒะฝะฐั ะธะดะตั

ะะพะปัะทะพะฒะฐัะตะปั ะพัะฒะตัะฐะตั ะฝะฐ 3 ะฒะพะฟัะพัะฐ ะฒ Telegramโะฑะพัะต:

1. **ะะฝัะตัะตัั** (ะฝะฐะฟัะธะผะตั: ยซัััะธัโะฐัั, ะธััะพัะธั, ะบะพัะตะนะฝะธยป);
2. **ะกะฒะพะฑะพะดะฝะพะต ะฒัะตะผั** ะฒ ัะฐัะฐั (ะผะพะถะฝะพ ะดัะพะฑะฝะพะต ัะธัะปะพ, ะฝะฐะฟัะธะผะตั 1.5);
3. **ะขะตะบััะตะต ะผะตััะพะฟะพะปะพะถะตะฝะธะต** (ะฐะดัะตั, ะบะพะพัะดะธะฝะฐัั ะธะปะธ ะณะตะพะฟะพะทะธัะธั).

ะะพั ะฟะพะดะฑะธัะฐะตั ัะตะฐะปัะฝัะต ัะพัะบะธ ะฒ ะะธะถะฝะตะผ ะะพะฒะณะพัะพะดะต, ัััะพะธั ะพะฟัะธะผะฐะปัะฝัะน ะผะฐััััั ั ััััะพะผ ะฒัะตะผะตะฝะธ ะฝะฐ ัะพะดัะฑั ะธ ะพัะผะพัั ะธ ัะพัะผะธััะตั **ัะตะบััโะณะธะด** ั ะฟะพััะฝะตะฝะธะตะผ: *ยซะฟะพัะตะผั ะธะดัะผ ะธะผะตะฝะฝะพ ััะดะฐยป*.

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```text
bitter_test/
โโโ data/                      # ะััะพะดะฝัะต ะดะฐะฝะฝัะต (ะดะฐัะฐัะตั ะบัะปััััะฝัั ะพะฑัะตะบัะพะฒ)
โโโ osrm/                      # ะะพะบะฐะปัะฝัะน ะบะพะฝัะตะนะฝะตั OSRM ะดะปั ัะฐััััะฐ ะผะฐัััััะพะฒ
โโโ qdrant_storage/            # ะฅัะฐะฝะธะปะธัะต ะฒะตะบัะพัะฝะพะณะพ ะฟะพะธัะบะฐ Qdrant
โโโ src/
โ   โโโ routes/
โ   โ   โโโ app.py                # Telegram-ะฑะพั (ะพัะฝะพะฒะฝะฐั ะปะพะณะธะบะฐ ะธ FSM-ะดะธะฐะปะพะณ)
โ   โ   โโโ cultural_qdrant.py    # ะะฝะดะตะบัะฐัะธั ะธ ะฟะพะธัะบ ะฟะพ ะบัะปััััะฝัะผ ะพะฑัะตะบัะฐะผ
โ   โ   โโโ geo_search.py         # ะกะตะผะฐะฝัะธัะตัะบะธะน + ะณะตะพ-ัะตัะฐะฝะบะธะฝะณ
โ   โ   โโโ route_builder_foot.py # ะะพัััะพะตะฝะธะต ะผะฐัััััะฐ ะธ ะณะตะฝะตัะฐัะธั ะบะฐััั Folium
โ   โ   โโโ route_builder_limit.py# ะะณัะฐะฝะธัะตะฝะธะต ะผะฐัััััะฐ ะฟะพ ะฒัะตะผะตะฝะธ
โ   โ   โโโ utils.py              # ะะตะพะบะพะดะตั ะธ ะฒัะฟะพะผะพะณะฐัะตะปัะฝัะต ััะฝะบัะธะธ
โ   โ   โโโ gorky_guide.py        # ะะตะฝะตัะฐัะธั ัะตะบััะพะฒะพะณะพ ะณะธะดะฐ ัะตัะตะท Google Gemini
โโโ docker-compose.yml         # ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ OSRM + Qdrant
โโโ .env / env_example         # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ัะพะบะตะฝั, ะบะปััะธ API)
โโโ requirements.txt           # Python-ะทะฐะฒะธัะธะผะพััะธ
```

---

## ๐งญ ะะฐะฒะธะณะฐัะธั ะฟะพ ะบะพะดั

### ะขะพัะบะธ ะฒัะพะดะฐ
- **`src/app.py`** โ ะฒัะพะด ะฑะพัะฐ ะธ ะผะธะฝะธโะฒะตะฑโัะตัะฒะตัะฐ.  
  FSMโะดะธะฐะปะพะณ: ัะฑะพั ะธะฝัะตัะตัะพะฒ โ ะฒัะตะผะตะฝะธ โ ะปะพะบะฐัะธะธ.  
  `finalize_route(...)` โ ะณะปะฐะฒะฝัะน ะพัะบะตัััะฐัะพั: ะฒัะทัะฒะฐะตั ะฟะพะดะฑะพั ัะพัะตะบ, ะบะพะฝััััะธััะตั HTMLโะบะฐััั, ะณะตะฝะตัะธััะตั ัะตะบััโะณะฐะนะด ะธ ะพัะฟัะฐะฒะปัะตั ัััะปะบั ะฟะพะปัะทะพะฒะฐัะตะปั.

### ะะพะดะฑะพั ะผะตัั ะธ ะผะฐัััััะธะทะฐัะธั
- **`src/geo_search.py`**  
  `semantic_topk(...)` โ ัะธััะพ ัะตะผะฐะฝัะธัะตัะบะธะน ัะพะฟ (ะฑะตะท ะณะตะพะณัะฐัะธะธ) ะดะปั ะฟะพะผะตัะบะธ ยซะพัะฝะพะฒะฝััยป ัะพัะตะบ.  
  `semantic_proximity_rerank(...)` โ ัะตะผะฐะฝัะธะบะฐ + ะณะตะพโะฑะปะธะทะพััั (e^{-d/ฯ}), ะธัะพะณะพะฒัะน ัะบะพั ะดะปั ัะฐะฝะถะธัะพะฒะฐะฝะธั ะบะฐะฝะดะธะดะฐัะพะฒ ััะดะพะผ ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ.  
  ะะฐะถะฝัะต ะฐัะณัะผะตะฝัั: `alpha` (ะฒะตั ัะตะผะฐะฝัะธะบะธ vs ะณะตะพ), `geo_tau_km` (ะบะฐะบ ะฑััััะพ ะทะฐัััะฐะตั ะณะตะพโะฒะตั), `hard_drop_km` (ะถัััะบะธะน ัะฐะดะธัั ะพััะตัะตะฝะธั).

- **`src/route_builder_limit.py`** *(ะพัะฝะพะฒะฝะพะน ะฟะปะฐะฝะธัะพะฒัะธะบ ะผะฐัััััะฐ; ัะผ. `plan_route_under_budget` ะฒะฝัััะธ)*  
  `plan_route_under_budget(...)` โ ะฒัะฑะธัะฐะตั N ะฟะตัะฒัั ะบะฐะฝะดะธะดะฐัะพะฒ, ะธัะตั ะฟะพััะดะพะบ ะพะฑัะพะดะฐ (**nearest neighbor + 2โopt**), ะฟัะพะฒะตััะตั, ััะพ ััะผะผะฐัะฝะพะต ะฒัะตะผั โค ะฑัะดะถะตั, ะณะตะฝะตัะธััะตั HTMLโะบะฐััั.  
  ะฃะฟัะฐะฒะปัะตั: ะบะพะปะธัะตััะฒะพะผ ยซะณะปะฐะฒะฝััยป (`main_semantic_k`), ะฑะฐะปะฐะฝัะพะผ ัะตะผะฐะฝัะธะบะธ/ะณะตะพ (`alpha`, `geo_tau_km`), ัะบะพัะพัััั ัะพะดัะฑั (`pace_scale`), ะดะปะธัะตะปัะฝะพัััั ะพััะฐะฝะพะฒะพะบ ะฟะพ ัะพะปัะผ (15 ะผะธะฝ ะดะปั `main`, 3 ะผะธะฝ ะดะปั `additional`).

- **`src/route_builder_foot.py`**  
  ะะฐะฟัะพัั ะบ OSRM: `osrm_table(...)` (ะผะฐััะธัะฐ ะดะปะธัะตะปัะฝะพััะตะน/ะดะธััะฐะฝัะธะน), `osrm_route(...)` (ะปะธะฝะธั ะฝะฐ ะบะฐััะต).  
  ะะพัััะพะตะฝะธะต ะบะฐััั Folium: `build_walking_route(...)` โ ัะธััะตั ะฟะพะปะธะปะธะฝะธั, ะผะฐัะบะตัั, ัััะตะปะบะธ ะฝะฐะฟัะฐะฒะปะตะฝะธั, ะฑะปะพะบ ยซะะตะณะตะฝะดะฐ ะผะฐัััััะฐยป.  
  ะญะฒัะธััะธะบะธ ะผะฐัััััะฐ: `nearest_neighbor(...)`, `two_opt(...)`.

### ะะฐะฝะฝัะต ะธ ะฟะพะธัะบ
- **`src/cultural_qdrant.py`**  
  ะะฝะดะตะบัะฐัะธั ะดะฐัะฐัะตัะฐ ะฒ **Qdrant** ั ัะผะฑะตะดะดะธะฝะณะฐะผะธ **intfloat/multilingualโe5โlarge**.  
  `recreate_and_index(...)` โ ะทะฐะณััะทะบะฐ Excel โ ะณะตะฝะตัะฐัะธั ะฒะตะบัะพัะพะฒ โ upsert ะฒ Qdrant.  
  `Searcher.search(...)` โ ะฑัััััะน ะฟะพะธัะบ topโk ะฟะพ ัะผะฑะตะดะดะธะฝะณะฐะผ.  
  ะะฐััะฐ ะบะฐัะตะณะพัะธะน `CATEGORY_MAP` ะธ ัะพัะผะธัะพะฒะฐะฝะธะต ัะตะบััะฐ ะดะปั ัะผะฑะตะดะดะธะฝะณะฐ `text_for_embedding(...)`.

### ะะฐะนะด ะฟะพ ะผะฐัััััั
- **`src/gorky_guide.py`** 
  `get_reason(...)` โ ะทะฐะฟัะพั ะฒ **Google Gemini** ะดะปั ะณะตะฝะตัะฐัะธะธ JSONโะณะฐะนะดะฐ (intro / mains / extras / outro).  
  `render_guide_text(...)` โ ะฐะบะบััะฐัะฝัะน ัะตะบัั ะดะปั Telegram ะธะท JSONโััััะบัััั.

### ะัะฟะพะผะพะณะฐัะตะปัะฝะพะต
- **`src/utils.py`** โ ััะธะปะธัั, ะฝะฐะฟัะธะผะตั `geocode_nominatim(...)` (ะฟะพะธัะบ ะฐะดัะตัะพะฒ ัะตัะตะท Nominatim).  
- **`src/routes/`** โ ะฟะฐะฟะบะฐ, ะบัะดะฐ ัะบะปะฐะดัะฒะฐัััั ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัะต HTMLโะผะฐัััััั; ััะฐัะธะบะฐ ัะฐะทะดะฐัััั ะผะธะฝะธโะฒะตะฑโัะตัะฒะตัะพะผ ะฒ `app.py`.

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั (ะฒะตััะฝะตััะพะฒะฝะตะณะพ)

```text
Telegram -> app.py (FSM)
  โโ ะธะฝัะตัะตัั, ัะฐัั, ะปะพะบะฐัะธั
  โโ plan_route_under_budget(...)
  โ   โโ geo_search.semantic_topk(...)              (ัะตะผะฐะฝัะธัะตัะบะธะต "ะณะปะฐะฒะฝัะต")
  โ   โโ geo_search.semantic_proximity_rerank(...)  (ัะตะผะฐะฝัะธะบะฐ + ะณะตะพ)
  โ   โโ route_builder_foot.osrm_table/route(...)   (OSRM)
  โ   โโ nearest_neighbor + two_opt                 (ะฟะพััะดะพะบ)
  โ   โโ build_walking_route(...) -> HTML ะบะฐััะฐ + ะปะตะณะตะฝะดะฐ
  โโ gorky_guide.get_reason(...)  -> JSON
  โโ gorky_guide.render_guide_text(...) -> ัะตะบัั
  โโ ะพัะฟัะฐะฒะบะฐ ัะตะบััะฐ + ะบะฝะพะฟะบะธ ยซะัะบัััั ะผะฐัััััยป
```
